name: Run migration and deploy on merge

on:
  merge:
    branches:
      main
      master 

  jobs:
    update:
      runs-on: ubuntu-latest

      steps:
      - name: Checkout repository
        uses: actions/checkout@v2
    
      - name: Use Node.js
        uses: actions/setup-node@v2
        with:
          node-version: "16"
      
      - name: Install packages 
        run: pip install -r requirements.txt 
      
      - name: Create migration
        run: beetle migration:create --path=./courses --output=./migration.json --update=false

      - name: Update migration
        run: beetle migration:update --file=./migration.json
      
      - name: Deploy migration 
        run: beetle migration:deploy --file=./migration.json

      